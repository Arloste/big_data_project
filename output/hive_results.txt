0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> DROP DATABASE IF EXISTS team30_projectdb CASCADE;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> DROP TABLE IF EXISTS rides;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> CREATE DATABASE team30_projectdb LOCATION "project/hive/warehouse";
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> USE team30_projectdb;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> CREATE EXTERNAL TABLE rides STORED AS AVRO LOCATION 'project/warehouse/rides' TBLPROPERTIES ('avro.schema .url'='project/warehouse/avsc/rides.avsc');
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> SELECT * FROM rides LIMIT 5;
+-----------------+--------------------+---------------------+------------------------+----------------------+-------------------------+------------------------+-------------------+---------------------------+--------------------------+-------------------------+---------------------+--------------------+--------------+----------------+------------------------------+-------------------+---------------------+---------------------+
| rides.vendorid  | rides.pickup_time  | rides.dropoff_time  | rides.passenger_count  | rides.trip_distance  | rides.pickup_longitude  | rides.pickup_latitude  | rides.ratecodeid  | rides.store_and_fwd_flag  | rides.dropoff_longitude  | rides.dropoff_latitude  | rides.payment_type  | rides.fare_amount  | rides.extra  | rides.mta_tax  | rides.improvement_surcharge  | rides.tip_amount  | rides.tolls_amount  | rides.total_amount  |
+-----------------+--------------------+---------------------+------------------------+----------------------+-------------------------+------------------------+-------------------+---------------------------+--------------------------+-------------------------+---------------------+--------------------+--------------+----------------+------------------------------+-------------------+---------------------+---------------------+
| 2               | 1421337939000      | 1421339022000       | 1                      | 1.59                 | -73.993896484375        | 40.7501106262207       | 1                 | N                         | -73.97478485107422       | 40.75061798095703       | 1                   | 12.0               | 1.0          | 0.5            | 3.25                         | 0.0               | 0.3                 | 17.05               |
| 1               | 1420911218000      | 1420912408000       | 1                      | 3.3                  | -74.00164794921875      | 40.7242431640625       | 1                 | N                         | -73.99441528320312       | 40.75910949707031       | 1                   | 14.5               | 0.5          | 0.5            | 2.0                          | 0.0               | 0.3                 | 17.8                |
| 1               | 1420911218000      | 1420911821000       | 1                      | 1.8                  | -73.96334075927734      | 40.80278778076172      | 1                 | N                         | -73.95182037353516       | 40.82441329956055       | 2                   | 9.5                | 0.5          | 0.5            | 0.0                          | 0.0               | 0.3                 | 10.8                |
| 1               | 1420911219000      | 1420911331000       | 1                      | 0.5                  | -74.00908660888672      | 40.71381759643555      | 1                 | N                         | -74.00432586669923       | 40.71998596191406       | 2                   | 3.5                | 0.5          | 0.5            | 0.0                          | 0.0               | 0.3                 | 4.8                 |
| 1               | 1420911219000      | 1420912378000       | 1                      | 3.0                  | -73.97117614746094      | 40.762428283691406     | 1                 | N                         | -74.00418090820312       | 40.742652893066406      | 2                   | 15.0               | 0.5          | 0.5            | 0.0                          | 0.0               | 0.3                 | 16.3                |
+-----------------+--------------------+---------------------+------------------------+----------------------+-------------------------+------------------------+-------------------+---------------------------+--------------------------+-------------------------+---------------------+--------------------+--------------+----------------+------------------------------+-------------------+---------------------+---------------------+
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- using our dataset
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> USE team30_projectdb;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- create Hive Table 1
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> DROP TABLE IF EXISTS q1_results;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> CREATE TABLE q1_results(
. . . . . . . . . . . . . . . . . . . . . . .> vendorId SMALLINT,
. . . . . . . . . . . . . . . . . . . . . . .> total_amount DECIMAL)
. . . . . . . . . . . . . . . . . . . . . . .> ROW FORMAT DELIMITED FIELDS TERMINATED BY ','
. . . . . . . . . . . . . . . . . . . . . . .> location 'project/hive/warehouse/q1';
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- run query & save results in table 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> SET hive.resultset.use.unique.column.names = false;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> INSERT INTO q1_results
. . . . . . . . . . . . . . . . . . . . . . .> SELECT p.vendorid as vendorid, SUM(p.total_amount) as total_sum
. . . . . . . . . . . . . . . . . . . . . . .> FROM (
. . . . . . . . . . . . . . . . . . . . . . .>     SELECT * FROM rides LIMIT 100
. . . . . . . . . . . . . . . . . . . . . . .> ) as p
. . . . . . . . . . . . . . . . . . . . . . .> GROUP BY p.vendorid;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- save table to hdfs
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> INSERT OVERWRITE DIRECTORY 'project/output/q1' 
. . . . . . . . . . . . . . . . . . . . . . .> ROW FORMAT DELIMITED FIELDS 
. . . . . . . . . . . . . . . . . . . . . . .> TERMINATED BY ',' 
. . . . . . . . . . . . . . . . . . . . . . .> SELECT * FROM q1_results;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 